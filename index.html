<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>勤務確認</title>

  <!-- ★キャッシュ対策：?v=3 を付ける -->
  <link rel="stylesheet" href="style.css?v=3" />
</head>
<body>

  <!-- ① 初期画面 -->
  <section id="screen-home" class="screen active">
    <h1 class="title">勤務確認</h1>

    <button id="goBtn" class="go-btn" type="button">GO!</button>

    <div id="userName" class="user-name">（未登録）</div>
  </section>

  <!-- ② 点呼簿（PDF）画面 -->
  <section id="screen-pdf" class="screen">
    <div class="topbar">
      <button id="backBtn" class="back-btn" type="button">← 戻る</button>
      <div class="top-title">点呼簿確認</div>
      <div style="width:44px;"></div>
    </div>

    <div class="pdf-wrap">
      <!-- ★ここを自分のPDFファイル名に合わせてください -->
      <a class="pdf-link" href="スキャン_20251104-1111.pdf" target="_blank" rel="noopener">
        <div class="pdf-card">
          <div class="pdf-icon">PDF</div>
          <div class="pdf-name">スキャン_20251104-1111.pdf</div>
          <div class="pdf-open">開く</div>
        </div>
      </a>
    </div>

    <!-- 画面下の「確認しました」エリア -->
    <div class="confirm-bar">
      <label class="confirm-left">
        <input id="confirmCheck" type="checkbox" />
        <span>確認しました</span>
      </label>

      <div class="confirm-right">
        <span class="confirmed-title">確認者：</span>
        <span id="confirmedList" class="confirmed-list">まだいません</span>
      </div>
    </div>
  </section>

<script>
  // ===== 画面切り替え =====
  const home = document.getElementById("screen-home");
  const pdf  = document.getElementById("screen-pdf");
  const goBtn = document.getElementById("goBtn");
  const backBtn = document.getElementById("backBtn");

  function showHome(){ home.classList.add("active"); pdf.classList.remove("active"); window.scrollTo(0,0); }
  function showPdf(){ pdf.classList.add("active"); home.classList.remove("active"); window.scrollTo(0,0); }

  // ===== 名前保存（スマホに保存）=====
  const userNameEl = document.getElementById("userName");

  function getName(){ return localStorage.getItem("bus_name") || ""; }
  function setName(name){ localStorage.setItem("bus_name", name); }

  function ensureName(){
    let name = getName();
    if(!name){
      name = prompt("お名前を入力してください（例：青山）") || "";
      name = name.trim();
      if(!name){
        alert("名前が未入力です。もう一度GOを押してください。");
        return false;
      }
      setName(name);
    }
    userNameEl.textContent = name ? ("MKB " + name) : "（未登録）";
    return true;
  }

  // 初回表示
  (function init(){
    const n = getName();
    userNameEl.textContent = n ? ("MKB " + n) : "（未登録）";
  })();

  goBtn.addEventListener("click", () => {
    if(!ensureName()) return;
    showPdf();
  });

  backBtn.addEventListener("click", showHome);

  // ===== 「確認しました」チェック（今回は端末内だけで動く簡易版）=====
  // ※あとで「全員で共有（誰が押したか）」に拡張できます
  const confirmCheck = document.getElementById("confirmCheck");
  const confirmedList = document.getElementById("confirmedList");

  function loadConfirmed(){
    const arr = JSON.parse(localStorage.getItem("bus_confirmed") || "[]");
    if(arr.length === 0) confirmedList.textContent = "まだいません";
    else confirmedList.textContent = arr.join("、");
  }

  function addConfirmed(name){
    const arr = JSON.parse(localStorage.getItem("bus_confirmed") || "[]");
    if(!arr.includes(name)) arr.push(name);
    localStorage.setItem("bus_confirmed", JSON.stringify(arr));
  }

  loadConfirmed();

  confirmCheck.addEventListener("change", () => {
    const name = getName();
    if(!name){
      alert("先にGOで名前登録してください");
      confirmCheck.checked = false;
      return;
    }
    if(confirmCheck.checked){
      addConfirmed(name);
      loadConfirmed();
      alert("確認しました を登録しました");
    }
  });
</script>

</body>
</html>
